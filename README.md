# ? Real-time Whisper Subtitles (Optimized)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.11](https://img.shields.io/badge/python-3.11-blue.svg)](https://www.python.org/downloads/release/python-3110/)
[![CUDA 12.9.0](https://img.shields.io/badge/CUDA-12.9.0-green.svg)](https://developer.nvidia.com/cuda-downloads)
[![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=flat&logo=docker&logoColor=white)](https://www.docker.com/)

**??????????????????????**

OpenAI Whisper + CUDA 12.9.0 + cuDNN?????????????????????????Web???????????

## ? ????

### ? ????????
- **WebSocket**?????????????
- **Voice Activity Detection (VAD)**???????????
- **GPU??**???RTF?Real-Time Factor?< 1.0?????

### ? AI?????
- **OpenAI Whisper**?????????tiny ? large-v3?
- **faster-whisper**????????????????
- **????????????**????????
- **?????**??????????????????

### ? ????????????
- **????WebUI**?Bootstrap 5 + Font Awesome?
- **???????**
- **????&????**?????????????
- **??????????**???????????????

### ? ?????
- **Prometheus + Grafana**????????????
- **???????**??
- **?????**?JSON???
- **Docker**?????????????

## ? ??????

### ????
- **GPU**: NVIDIA GPU?CUDA Compute Capability 6.0???
- **VRAM**: ??4GB???8GB???
- **RAM**: ??8GB???16GB???
- **CPU**: 4????
- **?????**: 10GB???????

### ????????
- **OS**: Ubuntu 20.04/22.04?CentOS 8+????Windows?WSL2?
- **Docker**: 20.10??
- **Docker Compose**: 2.0??
- **NVIDIA Docker**: nvidia-docker2

## ? ????????

### 1. ??????????
```bash
git clone https://github.com/nullpox7/realtime-whisper-subtitles-optimized.git
cd realtime-whisper-subtitles-optimized
```

### 2. ????
```bash
# ????????????
cp .env.example .env

# ???????????
nano .env
```

### 3. ????????????
```bash
mkdir -p data/{models,outputs,logs,cache}
chmod -R 755 data/
```

### 4. Docker Compose???
```bash
# ?????????
docker-compose up -d

# ?????????
docker-compose --profile monitoring up -d
```

### 5. ??????
????? `http://localhost:8000` ?????

## ? ????????

### NVIDIA Docker ???????

#### Ubuntu/Debian
```bash
# GPG?????
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

# ???????????????
sudo apt-get update
sudo apt-get install -y nvidia-docker2

# Docker????????
sudo systemctl restart docker
```

#### CentOS/RHEL
```bash
# ????????
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.repo | sudo tee /etc/yum.repos.d/nvidia-docker.repo

# ????????????
sudo yum install -y nvidia-docker2

# Docker????????
sudo systemctl restart docker
```

### ???????

#### ????
```bash
# GPU??
CUDA_VISIBLE_DEVICES=0
NVIDIA_VISIBLE_DEVICES=all

# Whisper?????
WHISPER_MODEL=base  # tiny, base, small, medium, large-v3
LANGUAGE=ja         # ???

# ?????????
MAX_WORKERS=4
BATCH_SIZE=16
COMPUTE_TYPE=float16
```

### ????Whisper??????

#### 1. ????????
```bash
# ?????????????
docker run --rm -v $(pwd)/data/models:/app/models \
  python:3.11-slim python -c "
import whisper
whisper.load_model('large-v3', download_root='/app/models/whisper')
"
```

#### 2. ???????
```bash
# ??????????
mkdir -p data/models/whisper/custom
cp your_custom_model.pt data/models/whisper/custom/
```

## ? ??????????

### ?????
```bash
# ????????
WHISPER_MODEL=large-v3
BEAM_SIZE=5
TEMPERATURE=0.0
ENABLE_WORD_TIMESTAMPS=true
```

### ??????
```bash
# ?????????
WHISPER_MODEL=tiny
BEAM_SIZE=1
TEMPERATURE=0.2
ENABLE_WORD_TIMESTAMPS=false
```

### GPU ??????
```bash
# ?????????
CUDA_MEMORY_FRACTION=0.8

# ?????????
BATCH_SIZE=8  # ?????: 16

# ??????????
ENABLE_QUANTIZATION=true
COMPUTE_TYPE=int8
```

### ??????
```bash
# ???????
LANGUAGE=ja
ENABLE_PUNCTUATION=true
MIN_CONFIDENCE=0.6

# ??????
TZ=Asia/Tokyo
LANG=ja_JP.UTF-8
LC_ALL=ja_JP.UTF-8
```

## ? ???????????

### GPU?????
```bash
# GPU????????
nvidia-smi

# Docker???????GPU??
docker exec -it whisper-subtitles-app nvidia-smi

# CUDA ????????
docker exec -it whisper-subtitles-app nvcc --version
```

### ??????
```bash
# Docker?????????
docker stats whisper-subtitles-app

# ?????????
free -h

# GPU ?????????
nvidia-smi --query-gpu=memory.used,memory.total --format=csv
```

### ???????
```bash
# PulseAudio???
pulseaudio --check -v

# ?????????
arecord -l

# ???????
ls -la /dev/snd/
```

### ???????????
```bash
# ????????
netstat -tulpn | grep 8000

# ???????????
sudo ufw status

# Docker ?????????
docker network ls
```

## ? ?????

### Prometheus + Grafana
```bash
# ?????????
docker-compose --profile monitoring up -d

# ???? URL
# Prometheus: http://localhost:9090
# Grafana: http://localhost:3000 (admin/admin)
```

### ?????
```bash
# ??????????
docker-compose logs -f whisper-subtitles

# ?????????
tail -f data/logs/whisper_app.log

# GPU????????????
watch -n 1 nvidia-smi
```

## ? ?????????

### CPU???
```bash
# CPU??????
CPU_THREADS=8

# CPU??????
docker run --cpuset-cpus="0-7" ...
```

### ??????
```bash
# ?????????
MEMORY_POOL_SIZE=2048

# ????????????
ENABLE_MEMORY_MAPPING=true
```

### ????????
```bash
# SSD ?????
# ????????SSD???
MODEL_PATH=/fast/storage/models

# ???????tmpfs???
docker run --tmpfs /tmp:rw,noexec,nosuid,size=2g ...
```

## ? ????????

### API?????
```bash
# ?????
RATE_LIMIT=100

# ???????????
MAX_UPLOAD_SIZE=100

# CORS??
ENABLE_CORS=true
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com
```

### SSL/HTTPS??
```bash
# ??????????SSL??
# Let's Encrypt??????

# ??????????
cp your-cert.pem data/ssl/
cp your-key.pem data/ssl/
```

## ? ??????????

?????????????????

1. ????????????
2. ????????????? (`git checkout -b feature/amazing-feature`)
3. ??????? (`git commit -m 'Add amazing feature'`)
4. ????????? (`git push origin feature/amazing-feature`)
5. ??????????

## ? ?????

????????? [MIT License](LICENSE) ????????????

## ? ??

- [OpenAI Whisper](https://github.com/openai/whisper) - ??????????
- [faster-whisper](https://github.com/guillaumekln/faster-whisper) - ?????????????
- [FastAPI](https://fastapi.tiangolo.com/) - ???Web???????
- [NVIDIA Docker](https://github.com/NVIDIA/nvidia-docker) - GPU???

## ? ?????

- **??????**: [SETUP.md](SETUP.md)
- **??????**: [GitHub Issues](https://github.com/nullpox7/realtime-whisper-subtitles-optimized/issues)
- **????????**: [GitHub Discussions](https://github.com/nullpox7/realtime-whisper-subtitles-optimized/discussions)

## ? ????

???????????????[GitHub Issues](https://github.com/nullpox7/realtime-whisper-subtitles-optimized/issues) ?????????????

---

**? ???????????????????????**
